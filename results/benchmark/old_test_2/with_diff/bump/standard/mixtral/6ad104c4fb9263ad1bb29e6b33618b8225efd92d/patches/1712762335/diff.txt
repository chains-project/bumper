1c1,42
< import org.bouncycastle.crypto.tls.AlertDescription;
\ No newline at end of file
---
> import org.bouncycastle.crypto.tls.TlsAlert;
> 
> // ...
> 
> public void decode(InputStream input, ByteQueue queue) throws IOException {
>     try {
>         int b = input.read();
>         if (b < 0) {
>             throw new EOFException("EOF while reading record");
>         }
>         int tag = b & 0x1F;
>         if (tag != TlsUtilities.TLS_contentType_applicationData) {
>             throw new TlsFatalAlert(AlertDescription.unexpected_message);
>         }
>         int length = TlsUtilities.readUint16(input);
>         if (length < 0) {
>             throw new TlsFatalAlert(AlertDescription.decode_error);
>         }
>         int max = queue.maximumCapacity();
>         if (length > max) {
>             throw new TlsFatalAlert(AlertDescription.internal_error);
>         }
>         if (length > 0) {
>             int offset = queue.writeLimit() - queue.capacity();
>             if (length > offset) {
>                 throw new TlsFatalAlert(AlertDescription.internal_error);
>             }
>             queue.compact(offset - length);
>         }
>         int total = 0;
>         while (total < length) {
>             b = input.read();
>             if (b < 0) {
>                 throw new EOFException("EOF while reading record");
>             }
>             queue.write(b);
>             total++;
>         }
>     } catch (IOException ex) {
>         throw new TlsFatalAlert(TlsFatalAlert.INTERNAL_ERROR, ex);
>     }
> }
\ No newline at end of file
