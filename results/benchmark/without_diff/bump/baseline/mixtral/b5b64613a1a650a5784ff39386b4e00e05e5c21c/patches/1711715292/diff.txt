11a12
>             Credentials credentials = null;
13,15c14,16
<                 artifactoryServer = new ArtifactoryServer(artifactoryUrl, step.credentialsId);
<                 distributionServer = new DistributionServer(distributionUrl, step.credentialsId);
<             } else {
---
>                 credentials = new UsernamePasswordCredentialsImpl(step.credentialsId, step.username, step.password);
>             }
>             if (credentials == null) {
17a19,21
>             } else {
>                 artifactoryServer = new ArtifactoryServer(artifactoryUrl, credentials);
>                 distributionServer = new DistributionServer(distributionUrl, credentials);
19c23
<             artifactoryServer.setPlatformUrl(urlWithoutSlash);
---
>             artifactoryServer.setUrl(urlWithoutSlash);
