import org.apache.maven.artifact.DependencyResolutionRequiredException;
import org.apache.maven.plugin.AbstractMojo;
import org.apache.maven.plugin.BuildException;
import org.apache.maven.plugins.annotations.Component;
import org.apache.maven.plugins.annotations.Parameter;
import org.apache.maven.project.MavenProject;
import org.codehaus.plexus.components.io.resources.PlexusIoResource;
import org.codehaus.plexus.components.io.resources.PlexusIoResourceFilterWriter;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.Enumeration;
import java.util.Properties;
import java.util.zip.ZipEntry;
import java.util.zip.ZipFile;

public class UnPackThemeMojo extends AbstractMojo {
    // ...

    @Parameter(defaultValue = "${project}", readonly = true, required = true)
    private MavenProject project;

    // ...

    @Override
    public void execute() throws DependencyResolutionRequiredException {
        String themeVersion = getThemeVersion();

        File outputDirectory = new File(project.getBuild().getDirectory(), "tobago-theme");
        if (!outputDirectory.exists()) {
            if (!outputDirectory.mkdirs()) {
                throw new BuildException("Unable to create output directory: " + outputDirectory.getAbsolutePath());
            }
        }

        File themeFile = new File(outputDirectory, "theme.properties");
        try (FileOutputStream themeFileOutputStream = new FileOutputStream(themeFile)) {
            Properties themeProperties = new Properties();
            themeProperties.setProperty("tobago.version", themeVersion);
            themeProperties.store(themeFileOutputStream, null);
        } catch (IOException e) {
            throw new BuildException("Unable to write theme.properties file: " + themeFile.getAbsolutePath(), e);
        }

        File themeZipFile = new File(project.getBuild().getDirectory(), "tobago-theme.zip");
        try (ZipFile themeZip = new ZipFile(themeZipFile)) {
            Enumeration<? extends ZipEntry> zipEntries = themeZip.entries();
            while (zipEntries.hasMoreElements()) {
                ZipEntry zipEntry = zipEntries.nextElement();
                if (!zipEntry.isDirectory()) {
                    File destFile = new File(outputDirectory, zipEntry.getName());
                    if (!destFile.getParentFile().exists()) {
                        if (!destFile.getParentFile().mkdirs()) {
                            throw new BuildException("Unable to create directory: " + destFile.getParentFile().getAbsolutePath());
                        }
                    }
                    try (FileOutputStream destFileOutputStream = new FileOutputStream(destFile)) {
                        try (InputStream zipEntryInputStream = themeZip.getInputStream(zipEntry)) {
                            byte[] buffer = new byte[1024];
                            int length;
                            while ((length = zipEntryInputStream.read(buffer)) > 0) {
                                destFileOutputStream.write(buffer, 0, length);
                            }
                        }
                    }
                }
            }
        } catch (IOException e) {
            throw new BuildException("Unable to extract theme.zip file: " + themeZipFile.getAbsolutePath(), e);
        }
    }
}