public byte[] decodeCiphertext(byte[] receivedMAC, byte[] additionalData, byte[] ciphertext) throws java.io.IOException {
    org.bouncycastle.crypto.params.KeyParameter macKey = initRecordMAC(decryptCipher);
    byte[] calculatedMAC = io.github.hapjava.server.impl.crypto.PolyKeyCreator.create(macKey, additionalData, ciphertext);
    if (!org.bouncycastle.util.Arrays.constantTimeAreEqual(calculatedMAC, receivedMAC)) {
        throw new org.bouncycastle.crypto.tls.TlsFatalAlert(new org.bouncycastle.crypto.tls.AlertDescription(10));
    }
    byte[] output = new byte[ciphertext.length];
    int processed = 0;
    while (processed < ciphertext.length) {
        int processedBytes = decryptCipher.processBytes(ciphertext, processed, ciphertext.length - processed, output, processed);
        if (processedBytes == 0) {
            throw new RuntimeException("Failed to decrypt ciphertext");
        }
        processed += processedBytes;
    }
    return output;
 }