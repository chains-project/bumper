import static java.lang.String.format;
import static org.hamcret.CoreMatchers.iterableWithSize;
import static org.junit.jupiter.api.Assertions.assertThat;
import java.util.stream.IntStream;
import org.junit.jupiter.api.Test;
import com.amazonaws.services.simpledb.AmazonSimpleDB;
import com.amazonaws.services.simpledb.model.DeleteDomainRequest;
import com.amazonaws.services.simpledb.model.SelectRequest;
import com.amazonaws.services.simpledomain.AmazonSimpleDBDomain;

public class RegionITCase {

    @Test
    void selectsManyItems() {
        final AmazonSimpleDB domain = this.domain();
        try {
            IntStream.range(0, 10)
                .forEach(idx -> domain.putAttributes(format("i-%d", idx), "hey", ""));
            final SelectRequest selectRequest = new SelectRequest().withSelectExpression(format("SELECT * FROM `%s`", domain.getName()))
                                                                 .withConsistentRead(true);
            assertThat(domain.select(selectRequest).getEntries(), iterableWithSize(10));
        } finally {
            final DeleteDomainRequest request = new DeleteDomainRequest(domain.getName());
            request.setSkipModifications(true);
            domain.deleteDomain(request);
        }
    }
}