import com.jcraft.jsch.ChannelExec;
import com.jcraft.jsch.JSchException;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.util.concurrent.TimeUnit;

// ...

@RetryOnFailure(
    attempts = Tv.SEVEN,
    delay = 1,
    unit = TimeUnit.MINUTES,
    verbose = false,
    types = IOException.class
)
protected Session session() throws IOException {
    JSch jsch = new JSch();
    Session session = null;
    try {
        jsch.setLogger(new JschLogger());
        session = jsch.getSession(this.getLogin(), this.getAddr(), this.getPort());
        session.setConfig("StrictHostKeyChecking", "no");
        session.setPassword(this.password);
        session.setServerAliveInterval((int) TimeUnit.SECONDS.toMillis(Tv.TEN));
        session.setServerAliveCountMax(Tv.MILLION);
        session.connect((int) TimeUnit.SECONDS.toMillis(10L));
    } catch (JSchException ex) {
        if (session != null) {
            session.disconnect();
        }
        throw new IOException(ex);
    }
    return session;
}

private String executeCommand(String command) throws IOException {
    Session session = session();
    ChannelExec channel = null;
    ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
    try {
        channel = (ChannelExec) session.openChannel("exec");
        channel.setCommand(command);
        channel.setInputStream(null);
        channel.setErrStream(System.err);
        OutputStream inputStream = channel.getOutputStream();
        channel.connect();
        inputStream.write(command.getBytes());
        inputStream.flush();
        inputStream.close();
        channel.join();
        return outputStream.toString();
    } catch (JSchException | InterruptedException e) {
        throw new IOException(e);
    } finally {
        if (channel != null) {
            channel.disconnect();
        }
        if (session != null) {
            session.disconnect();
        }
    }
}