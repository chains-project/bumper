@Test
void failsOnDigestMismatch() {
    final InMemoryStorage storage = new InMemoryStorage();
    final AstoBlobs blobs = new AstoBlobs(
        storage, new DefaultLayout(), new RepoName.Simple("any")
    );
    final String digest = "123";
    CheckedBlobSource checkedBlobSource = new CheckedBlobSource(new Content.From("data".getBytes()), new Digest.Sha256(digest));
    Blob blob = blobs.put(checkedBlobSource).join();
    Digest calculatedDigest = blob.digest();
    Assert.assertNotEquals(
        "Exception thrown",
        digest,
        calculatedDigest.toString()
    );
    Assert.assertEquals(
        "Exception is InvalidDigestException",
        InvalidDigestException.class,
        blob.exception().getClass()
    );
    Assert.assertThat(
        "Exception message contains calculated digest",
        blob.exception().getMessage(),
        new CoreMatchers.AllOf(
            new CoreMatchers.StringContains(calculatedDigest.toString()),
            new CoreMatchers.StringContains(digest)
        )
    );
}