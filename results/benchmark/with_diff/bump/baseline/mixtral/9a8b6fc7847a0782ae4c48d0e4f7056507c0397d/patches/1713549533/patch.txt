import org.jasypt.util.text.TextEncryptor;
import org.jasypt.util.password.PasswordEncryptor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.crypto.password.Pbkdf2PasswordEncoder;

@Override
public PasswordEncoder passwordEncoder() {
    TextEncryptor textEncryptor = new TextEncryptor();
    PasswordEncryptor passwordEncryptor = new PasswordEncryptor();
    PasswordEncoder delegate = new Pbkdf2PasswordEncoder();

    textEncryptor.setPassword(password);
    passwordEncryptor.setAlgorithm(algorithm);
    delegate.setPasswordEncoder(passwordEncryptor);

    return (input, encoded) -> {
        if (encoded == null || encoded.isEmpty()) {
            return delegate.encode(input);
        } else {
            boolean matches = delegate.matches(input, encoded);
            if (matches) {
                return encoded;
            } else {
                return null;
            }
        }
    };
}